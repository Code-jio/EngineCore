var e;e=()=>(()=>{var e={d:(t,s)=>{for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{BasePlugin:()=>s,Core:()=>r,eventBus:()=>n,pluginManager:()=>i});class s{constructor(e){this.name=e.name,this.path=e.path,this.strategy=e.strategy||"sync",this.status="unloaded",this.dependencies=e.dependencies||[],this.instance=null}async init(e){}async start(){}async stop(){}}class n{constructor(){this.listeners=new Map}on(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}off(e,t){const s=this.listeners.get(e);s&&this.listeners.set(e,s.filter((e=>e!==t)))}emit(e,...t){const s=this.listeners.get(e);s&&s.forEach((e=>e(...t)))}clear(){this.listeners.clear()}}class i{constructor(){this.registry=new Map,this.eventBus={listeners:new Map,on(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)},off(e,t){const s=this.listeners.get(e);s&&this.listeners.set(e,s.filter((e=>e!==t)))},emit(e,...t){const s=this.listeners.get(e);s&&s.forEach((e=>e(...t)))}},this.coreInterface={scene:new SceneAccess,resources:new ResourceLoader,getPlugin:e=>this.registry.get(e)},this.coreInterface.animation={requestFrame:e=>{requestAnimationFrame((()=>{this.eventBus.emit(CoreEvents.ANIMATION_FRAME),e()}))}}}register(e){const t=new e;this.registry.set(t.name,{instance:t,metadata:{name:t.name,version:t.version,status:"registered"}}),t.init(this.coreInterface)}async startAll(){for(const[e,{instance:t}]of this.registry)await t.start(),this.registry.get(e).metadata.status="running"}}class r{constructor(){this.pluginRegistry=new Map,this.eventBus=n,this.pluginManager=new i,this.loadStrategies={sync:this._loadSync.bind(this),async:this._loadAsync.bind(this)}}registerPlugin(e){if(this.eventBus.emit("beforePluginRegister",e),this.pluginRegistry.has(e.name)){const t=new Error(`Plugin ${e.name} already registered`);throw this.eventBus.emit("registrationError",{meta:e,error:t}),t}try{const t=new s(e);return this.pluginRegistry.set(t.name,t),this.eventBus.emit("pluginRegistered",{name:t.name,version:t.version,dependencies:t.dependencies}),!0}catch(t){throw this.eventBus.emit("registrationError",{meta:e,error:t}),new Error(`Plugin registration failed: ${t.message}`)}}async loadPlugin(e){const t=this.pluginRegistry.get(e);if(!t){const t=new Error(`Plugin ${e} not registered`);throw this.eventBus.emit("loadError",{pluginName:e,error:t}),t}try{this.eventBus.emit("beforePluginLoad",e),await this.loadStrategies[t.strategy](t),t.status="loaded",this.eventBus.emit("pluginInitialized",{name:e,exports:t.instance.getExports?.()||null})}catch(s){throw this.eventBus.emit("loadError",{pluginName:e,error:s,stack:s.stack}),t.status="error",s}}unregisterPlugin(e){if(this.eventBus.emit("beforePluginUnregister",e),!this.pluginRegistry.has(e))return this.eventBus.emit("unregisterWarning",`Attempt to unregister non-existent plugin: ${e}`),!1;const t=this.pluginRegistry.get(e);try{return this.eventBus.emit("beforePluginUnload",t),this._unload(t),this.pluginRegistry.delete(e),this.eventBus.emit("pluginUnregistered",{name:e,timestamp:Date.now()}),!0}catch(e){return this.eventBus.emit("unloadError",{plugin:t,error:e}),!1}}async _loadSync(e){const t=await import(e.path);e.instance=t.default?new t.default(this):t,e.instance.initialize?.()}async _loadAsync(e){return new Promise(((t,s)=>{const n=document.createElement("script");n.src=e.path,n.onload=()=>{e.instance=window[e.name],e.instance?.initialize?.(this),t()},n.onerror=s,document.head.appendChild(n)}))}_unload(e){e.instance?.uninstall?.(),e.instance=null,e.status="unloaded"}}return t})(),"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("MyLibrary",[],e):"object"==typeof exports?exports.MyLibrary=e():this.MyLibrary=e();